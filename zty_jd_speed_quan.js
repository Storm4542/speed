/*!
cron 0 6,8,10,12,14,16,18,20,22 * * * zty_jd_speed_quan.js
 */
var request=require("request");const $=new Env("ÊûÅÈÄüÁâàÈ¢ÜÂà∏"),notify=require("./sendNotify"),jdCookieNode=require("./jdCookie.js");let jdNotify=!0,cookiesArr=[],cookie="",message,helpInfo,ADD_CART=!1;//ÊòØÂê¶ÂÖ≥Èó≠ÈÄöÁü•ÔºåfalseÊâìÂºÄÈÄöÁü•Êé®ÈÄÅÔºåtrueÂÖ≥Èó≠ÈÄöÁü•Êé®ÈÄÅ
const SPEED_BODY="body=%7B%22activityId%22%3A%22Uq1k3RXYmRTSk4f9cSJi35DyLCT%22%2C%22scene%22%3A%221%22%2C%22args%22%3A%22key%3D768FBCE09A01A5CE330697C877362A68EEFDEFAEE3C54607BCDE86C860282E7F4E46D935213AB738B8D9B321F1338F06_babel%2CroleId%3D8B59054605B1813CE8F3A7DC27D17876_babel%2CstrengthenKey%3D26B714C2E2DD736FED2768351DA96C0B982C190B0BD5162C00454E6863F5C82B06B96759A6309796098622FD6D9B700A_babel%22%2C%22platform%22%3A%223%22%2C%22orgType%22%3A%222%22%2C%22openId%22%3A%22-1%22%2C%22pageClickKey%22%3A%22-1%22%2C%22eid%22%3A%226PJNI7RWSXZFFGUCORD3EW7J7VLYPXAXQN7HPAXZSUHEIZMAQK55N4RC4HAAR3ZNZAAPTJPYWFFL5QJ5Z7GTMPG6YU%22%2C%22fp%22%3A%22200e933416aec096b7b96d5786a1ede5%22%2C%22shshshfp%22%3A%22c78a0c7d1b9fef11dd1b6c0cad91a824%22%2C%22shshshfpa%22%3A%229984d840-f1d3-e9ee-ed54-af547d9229a9-1605779905%22%2C%22shshshfpb%22%3A%22fahBG22KKH57Gr1ENwMQY1A%3D%3D%22%2C%22childActivityUrl%22%3A%22https%253A%252F%252Fpro.m.jd.com%252Fjdlite%252Factive%252FUq1k3RXYmRTSk4f9cSJi35DyLCT%252Findex.html%253F__in_task_view__%253DjdLiteiOS%2526lng%253D0.000000%2526lat%253D0.000000%2526sid%253D5236d99e6d149a65aeed0557f078437w%2526un_area%253D13_1000_40492_59717%22%2C%22userArea%22%3A%22-1%22%2C%22client%22%3A%22-1%22%2C%22clientVersion%22%3A%22-1%22%2C%22uuid%22%3A%22-1%22%2C%22osVersion%22%3A%22-1%22%2C%22brand%22%3A%22-1%22%2C%22model%22%3A%22-1%22%2C%22networkType%22%3A%22-1%22%2C%22jda%22%3A%22122270672.1605779904461533860699.1605779904.1617086672.1617091698.86%22%2C%22sdkToken%22%3A%22%22%2C%22token%22%3A%22Z6Z7WM6DWFGZKFHP34HJIPMPQRKIEWLXQLZT22TSU4FFJ6UIFWYZWMMQL44B6VEBKJMAQNVGKQU2G%22%2C%22jstub%22%3A%22QIIVM5JJWHS7BI3CIXQNCIXUYBIV5PNRSQIL3TMKJ4CD2G4TIZG73Z4XPONLPUYP676VWEV4GQH7YGW2FXUCU524RQS7DKCK5QWWVVQ%22%2C%22pageClick%22%3A%22Babel_Coupon%22%2C%22la%22%3A%22605715ec560d6508f7403b91b677d79c%22%2C%22lb%22%3A%22605715ec560d6508f7403b91b677d79c%22%2C%22mitemAddrId%22%3A%22%22%2C%22geo%22%3A%7B%22lng%22%3A%220.000000%22%2C%22lat%22%3A%220.000000%22%7D%2C%22addressId%22%3A%22811092644%22%2C%22posLng%22%3A%22%22%2C%22posLat%22%3A%22%22%2C%22homeLng%22%3A%22%22%2C%22homeLat%22%3A%22%22%2C%22focus%22%3A%22%22%2C%22innerAnchor%22%3A%22%22%2C%22cv%22%3A%222.0%22%7D&screen=750*1334&client=wh5&clientVersion=1.0.0&sid=5236d99e6d149a65aeed0557f078437w&uuid=1605779904461533860699.76.1617092484095&area=13_1000_40492_59717";$.isNode()?(Object.keys(jdCookieNode).forEach(e=>{cookiesArr.push(jdCookieNode[e])}),process.env.JD_DEBUG&&"false"===process.env.JD_DEBUG&&(console.log=()=>{})):cookiesArr=[$.getdata("CookieJD"),$.getdata("CookieJD2"),...jsonParse($.getdata("CookiesJD")||"[]").map(e=>e.cookie)].filter(e=>!!e);var request=require("request"),options={method:"GET",url:"https://api.m.jd.com/client.action?functionId=queryMaterialProducts&client=wh5",headers:{}};function g(e,i){e={method:"POST",url:"https://api.m.jd.com/client.action?functionId=lite_newBabelAwardCollection",headers:{Host:"api.m.jd.com",Cookie:`__jd_ref_cls=Babel_AgilityExpo; mba_muid=1605779904461533860699.73.1617066793360; mba_sid=73.17; shshshfpb=fahBG22KKH57Gr1ENwMQY1A%3D%3D; 3AB9D23F7A4B3C9B=6PJNI7RWSXZFFGUCORD3EW7J7VLYPXAXQN7HPAXZSUHEIZMAQK55N4RC4HAAR3ZNZAAPTJPYWFFL5QJ5Z7GTMPG6YU; shshshfp=dc800b5fc7e1d1eaa8fe2ba7c367e04c; shshshfpa=9984d840-f1d3-e9ee-ed54-af547d9229a9-1605779905; shshshsID=359601bc1ff86449eb4b73aaef4aac91_2_1617066790701; __jda=122270672.1605779904461533860699.1605779904.1616939188.1617066637.83; __jdb=122270672.2.1605779904461533860699|83.1617066637; __jdc=122270672; pre_seq=0; pre_session=f763dceff5cf31896add3e06f1c745fbb34189c0|146; ${e} pwdt_id=jd_5d9b320a601be; sid=5236d99e6d149a65aeed0557f078437w; __jdv=122270672%7Cdirect%7C-%7Cnone%7C-%7C1617066637880; PPRD_P=LOGID.1616939189522.776213492; visitkey=70253261906795197`,accept:"*/*","content-type":"application/x-www-form-urlencoded",origin:"https://pro.m.jd.com","accept-language":"zh-cn","user-agent":"jdltapp;iPhone;3.3.0;14.4.2;f763dceff5cf31896add3e06f1c745fbb34189c0;network/wifi;ADID/9FAED639-BEA4-4E87-B414-9B50A40F3103;hasUPPay/0;pushNoticeIsOpen/0;lang/zh_CN;model/iPhone10,3;addressid/811092644;hasOCPay/0;appBuild/1036;supportBestPay/0;pv/73.16;apprpd/;ref/https%3A%2F%2Fpro.m.jd.com%2Fjdlite%2Factive%2FUq1k3RXYmRTSk4f9cSJi35DyLCT%2Findex.html%3F__in_task_view__%3DjdLiteiOS%26lng%3D0.000000%26lat%3D0.000000%26sid%3D5236d99e6d149a65aeed0557f078437w%26un_area%3D13_1000_40492_59717;psq/0;ads/;psn/f763dceff5cf31896add3e06f1c745fbb34189c0|146;jdv/0|;adk/;app_device/IOS;pap/JA2020_3112531|3.3.0|IOS 14.4.2;Mozilla/5.0 (iPhone; CPU iPhone OS 14_4_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148;supportJDSHWK/1",referer:"https://pro.m.jd.com/jdlite/active/Uq1k3RXYmRTSk4f9cSJi35DyLCT/index.html?__in_task_view__=jdLiteiOS&lng=0.000000&lat=0.000000&sid=5236d99e6d149a65aeed0557f078437w&un_area=13_1000_40492_59717"},body:SPEED_BODY};request(e,function(e,t){if(e)throw new Error(e);const s=JSON.parse(t.body);console.log(`Ë¥¶Âè∑${i}ÁªìÊûú‰∏∫${s.subCodeMsg}`),0<=s.subCodeMsg.indexOf("ÂÜçÊù•")||notify.sendNotify(`Ë¥¶Âè∑${i}ÁªìÊûú‰∏∫${s.subCodeMsg}`)})}
// prettier-ignore
function Env(r,e){"undefined"!=typeof process&&-1<JSON.stringify(process.env).indexOf("GITHUB")&&process.exit(0);class s{constructor(e){this.env=e}send(e,t="GET"){e="string"==typeof e?{url:e}:e;let s=this.get;return"POST"===t&&(s=this.post),new Promise((i,o)=>{s.call(this,e,(e,t,s)=>{e?o(e):i(t)})})}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}return new class{constructor(e,t){this.name=e,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log("",`üîî${this.name}, ÂºÄÂßã!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null){try{return JSON.stringify(e)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise(i=>{this.get({url:e},(e,t,s)=>i(s))})}runScript(r,a){return new Promise(i=>{let e=this.getdata("@chavy_boxjs_userCfgs.httpapi");e=e&&e.replace(/\n/g,"").trim();let t=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");t=t?+t:20,t=a&&a.timeout?a.timeout:t;var[s,o]=e.split("@"),s={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:r,mock_type:"cron",timeout:t},headers:{"X-Key":s,Accept:"*/*"}};this.post(s,(e,t,s)=>i(s))}).catch(e=>this.logErr(e))}loaddata(){if(!this.isNode())return{};this.fs=this.fs||require("fs"),this.path=this.path||require("path");var e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t);if(!s&&!i)return{};t=s?e:t;try{return JSON.parse(this.fs.readFileSync(t))}catch(e){return{}}}writedata(){var e,t,s,i,o;this.isNode()&&(this.fs=this.fs||require("fs"),this.path=this.path||require("path"),e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),i=!(s=this.fs.existsSync(e))&&this.fs.existsSync(t),o=JSON.stringify(this.data),!s&&i?this.fs.writeFileSync(t,o):this.fs.writeFileSync(e,o))}lodash_get(e,t,s){let i=e;for(const e of t.replace(/\[(\d+)\]/g,".$1").split("."))if(i=Object(i)[e],void 0===i)return s;return i}lodash_set(e,i,t){return Object(e)!==e||((i=!Array.isArray(i)?i.toString().match(/[^.[\]]+/g)||[]:i).slice(0,-1).reduce((e,t,s)=>Object(e[t])===e[t]?e[t]:e[t]=Math.abs(i[s+1])>>0==+i[s+1]?[]:{},e)[i[i.length-1]]=t),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){var[,s,i]=/^@(.*?)\.(.*?)$/.exec(e),s=s?this.getval(s):"";if(s)try{const e=JSON.parse(s);t=e?this.lodash_get(e,i,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){var[,i,o]=/^@(.*?)\.(.*?)$/.exec(t),r=this.getval(i),r=i?"null"===r?null:r||"{}":"{}";try{const t=JSON.parse(r);this.lodash_set(t,o,e),s=this.setval(JSON.stringify(t),i)}catch(t){r={};this.lodash_set(r,o,e),s=this.setval(JSON.stringify(r),i)}}else s=this.setval(e,t);return s}getval(e){return this.isSurge()||this.isLoon()?$persistentStore.read(e):this.isQuanX()?$prefs.valueForKey(e):this.isNode()?(this.data=this.loaddata(),this.data[e]):this.data&&this.data[e]||null}setval(e,t){return this.isSurge()||this.isLoon()?$persistentStore.write(e,t):this.isQuanX()?$prefs.setValueForKey(e,t):this.isNode()?(this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0):this.data&&this.data[t]||null}initGotEnv(e){this.got=this.got||require("got"),this.cktough=this.cktough||require("tough-cookie"),this.ckjar=this.ckjar||new this.cktough.CookieJar,e&&(e.headers=e.headers||{},void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar))}get(e,o=()=>{}){e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,(e,t,s)=>{!e&&t&&(t.body=s,t.statusCode=t.status),o(e,t,s)})):this.isQuanX()?(this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(e=>{var{statusCode:t,statusCode:s,headers:i,body:e}=e;o(null,{status:t,statusCode:s,headers:i,body:e},e)},e=>o(e))):this.isNode()&&(this.initGotEnv(e),this.got(e).on("redirect",(e,t)=>{try{var s;e.headers["set-cookie"]&&((s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString())&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar)}catch(e){this.logErr(e)}}).then(e=>{var{statusCode:t,statusCode:s,headers:i,body:e}=e;o(null,{status:t,statusCode:s,headers:i,body:e},e)},e=>{var{message:t,response:e}=e;o(t,e,e&&e.body)}))}post(e,o=()=>{}){if(e.body&&e.headers&&!e.headers["Content-Type"]&&(e.headers["Content-Type"]="application/x-www-form-urlencoded"),e.headers&&delete e.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(e,(e,t,s)=>{!e&&t&&(t.body=s,t.statusCode=t.status),o(e,t,s)});else if(this.isQuanX())e.method="POST",this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(e=>{var{statusCode:t,statusCode:s,headers:i,body:e}=e;o(null,{status:t,statusCode:s,headers:i,body:e},e)},e=>o(e));else if(this.isNode()){this.initGotEnv(e);const{url:t,...s}=e;this.got.post(t,s).then(e=>{var{statusCode:t,statusCode:s,headers:i,body:e}=e;o(null,{status:t,statusCode:s,headers:i,body:e},e)},e=>{var{message:t,response:e}=e;o(t,e,e&&e.body)})}}time(e,t=null){const s=t?new Date(t):new Date;var i,o={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};for(i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[i]:("00"+o[i]).substr((""+o[i]).length)));return e}msg(t=r,s="",i="",e){var o=e=>{return e&&("string"==typeof e?this.isLoon()?e:this.isQuanX()?{"open-url":e}:this.isSurge()?{url:e}:void 0:"object"==typeof e?this.isLoon()?{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]}:this.isQuanX()?{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl}:this.isSurge()?{url:e.url||e.openUrl||e["open-url"]}:void 0:void 0)};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(t,s,i,o(e)):this.isQuanX()&&$notify(t,s,i,o(e))),!this.isMuteLog){let e=["","==============üì£Á≥ªÁªüÈÄöÁü•üì£=============="];e.push(t),s&&e.push(s),i&&e.push(i),console.log(e.join("\n")),this.logs=this.logs.concat(e)}}log(...e){0<e.length&&(this.logs=[...this.logs,...e]),console.log(e.join(this.logSeparator))}logErr(e,t){!this.isSurge()&&!this.isQuanX()&&!this.isLoon()?this.log("",`‚ùóÔ∏è${this.name}, ÈîôËØØ!`,e.stack):this.log("",`‚ùóÔ∏è${this.name}, ÈîôËØØ!`,e)}wait(t){return new Promise(e=>setTimeout(e,t))}done(e={}){var t=((new Date).getTime()-this.startTime)/1e3;this.log("",`üîî${this.name}, ÁªìÊùü! üïõ ${t} Áßí`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(e)}}(r,e)}request(options,function(e,t){if(e)throw new Error(e);t=JSON.parse(t.body).currentTime2;const s=(new Date).getTime()-t;console.log(`Êú¨Âú∞Êó∂Èó¥‰∏éÊúçÂä°Âô®Êó∂Èó¥ÁöÑÂ∑ÆÂÄº‰∏∫${s}`),setTimeout(()=>{cookiesArr.forEach((e,t)=>{console.log(`Á≠âÂæÖ${s}msÊâßË°å`),g(e,t),g(e,t),g(e,t)})},1e3+s)});